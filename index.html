
<html>
<head>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/css/materialize.min.css" media="screen,projection" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!--Let browser know website is optimized for mobile-->
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
  <meta content="IE=EmulateIE9" http-equiv="X-UA-Compatible">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#516873">

  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://URLHERE.URLHERE/favicon/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="http://URLHERE.URLHERE/favicon/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="http://URLHERE.URLHERE/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="http://URLHERE.URLHERE/favicon/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="http://URLHERE.URLHERE/favicon/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="http://URLHERE.URLHERE/favicon/favicon-128.png" sizes="128x128" />
  <meta name="application-name" content="IoT Controlpanel"/>
  <meta name="msapplication-TileColor" content="#C2473B" />
  <meta name="msapplication-TileImage" content="http://URLHERE.URLHERE/favicon/mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="http://URLHERE.URLHERE/favicon/mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="http://URLHERE.URLHERE/favicon/mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="http://URLHERE.URLHERE/favicon/mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="http://URLHERE.URLHERE/favicon/mstile-310x310.png" />

  <title>IoT Controlpanel</title>
  <link href="/res/styles.css" rel="stylesheet" type="text/css">
</head>

<body class="grey lighten-3">

  <header>
    <nav class="teal lighten-2" style="padding-left: 12px;">
      <img src="/res/logo.svg" class="brand-logo right" />
      <ul id="slide-out" class="side-nav">
        <li><a href="#!">Apparaten</a></li>
        <li><a href="#!">Timers</a></li>
        <li><a href="#!">433MHz log</a></li>
      </ul>
      <a href="#" data-activates="slide-out" class="button-collapse show-on-large"><i class="mdi-navigation-menu"></i></a>
    </nav>
  </header>

  <main>
    <div class="row">
      <div class="col l10 offset-l1 m12 offset-m0 offset-m0">


        <div class="row section" id="login-section">
          <div class="col l6 offset-l3 m10 offset-m1 s12 offset-s0">
            <div class="card">
              <div class="card-content">

                <span class="card-title teal-text">Inloggen</span>
                <form class="col s12" id="login-form">
                  <div class="row">
                    <div class="input-field col s12">
                      <i class="material-icons prefix">account_circle</i>
                      <input id="login-form-username" type="text" class="validate" value="Edwin">
                      <label for="username">Gebruikersnaam</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="input-field col s12">
                      <i class="material-icons prefix">vpn_key</i>
                      <input id="login-form-password" type="password" class="validate" value="wachtwoord123">
                      <label for="password">Wachtwoord</label>
                    </div>
                  </div>
                  <div class="row">
                    <button class="btn waves-effect waves-light right" type="submit" name="action">Log in
                      <i class="material-icons right">send</i>
                    </button>
                  </div>
                </form>

              </div>
            </div>
          </div>
        </div>



        <div class="row section" id="cards-area">
        </div>



        <div class="row section">
          <div class="col l12 m12 s12">
            <div class="card">
              <div class="card-content">

                <i class="small material-icons red-text text-lighten-2" style="vertical-align: middle; font-size: 2.3rem;">bug_report</i>
                <span class="card-title red-text text-darken-1" style="vertical-align: middle; padding-left: 14px;">Socket.IO log</span>
                <div class="row">
                  <div class="col l12">
                    <pre id="logs"></pre>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>


      </div>
    </div>
  </main>


  <!--Import Socket.IO before jQuery-->
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <!--Import jQuery before materialize.js-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/js/materialize.min.js" type="text/javascript"></script>
  <script>
    $(function() {

      var deviceList = [];

      $('.button-collapse').sideNav({
          menuWidth: 300, // Default is 240
          edge: 'left', // Choose the horizontal origin
          closeOnClick: true // Closes side-nav on <a> clicks, useful for Angular/Meteor
        }
      );

      var socket = io('/clients');

      $('#login-form').submit(function( event ) {
        event.preventDefault();
        socket.emit('auth',{username:$('#login-form-username').val(), password:$('#login-form-password').val()});
      });


      $(document).on('change' , '.light-switch' , function()
      {
        console.log('light switch changed');
        for (i = 0; i < deviceList.length; i++) {
          var device = deviceList[i];
          console.log(device);
          if ($(this).data('device-id') == device.id) {
            device.values[0] = this.checked?1:0;;
            socket.emit('device', deviceList[i]);
            return;
          }
        }
      });

      $("input[type='checkbox'].light-switch").change(function() 
      {
        
      });

      socket.on('login-fail', function(){
        $('#login-form-username').addClass('invalid');
        $('#login-form-password').addClass('invalid');
        $('#login-form-username').removeClass('valid');
        $('#login-form-password').removeClass('valid');
      });

      socket.on('login-success', function(){
        $('#login-section').remove();
      });

      socket.on('controlstationCount', function(controlstationCount){
        log('Number of controlstations: ' + controlstationCount );
      });
      socket.on('devices', function(devices){
        log('Received ' + devices.length + ' devices' );
        deviceList = devices;
        $('#cards-area').html('');
        for(var i in deviceList)
        {
          addDeviceCard(devices[i]);
        }
      });

    });



    function log(msg) {
      console.log(msg);
      $('#logs').append(msg+'\n');
    }

    const DEVICE_TYPE_LIGHT = 'light-on-off';
    const DEVICE_TYPE_DIMMER = 'light-dimmer';
    function Device(name, type) {
      this.id = 0;
      this.name = name;
      this.type = type;
      switch (type) {
        case DEVICE_TYPE_DIMMER: 
          this.values = [0,0];
        default: 
          this.values = [0];
          break;
      }
    }

    function addDeviceCard(device) {
      var card = $("<div/>").attr("class", "col l6 m12").append(getBasicCard('wb_incandescent', device.name));

      var cardContent = $("<div/>").attr("class", "row").html('<div class="col l7 m8 s12" style="margin-bottom: 2em;">'+ 
                    '<p>Schakel dit apparaat aan of uit.</p>'+ 
                  '</div>'+ 
                  '<div class="col l5 m4 s12 right">'+ 
                    '<div class="switch center">'+ 
                      '<label>'+ 
                        'Uit'+ 
                        '<input type="checkbox" class="light-switch" data-device-id="'+device.id+'">'+ 
                        '<span class="lever"></span>'+ 
                        'Aan'+ 
                      '</label>'+ 
                    '</div>'+ 
                  '</div>');

      $(card).find('.card-content').append(cardContent);
      $('#cards-area').append(card);
    }

    function getBasicCard(icon, title) {

      return $("<div/>").attr("class", "card").html('<div class="card-content">'+
              '<i class="small material-icons grey-text text-lighten-2" style="vertical-align: middle; font-size: 2.3rem;">'+icon+'</i>'+
              '<span class="card-title orange-text text-darken-2" style="vertical-align: middle; padding-left: 14px;">'+title+'</span>'+
            '</div>');
    }

  </script>

</body>
</html>